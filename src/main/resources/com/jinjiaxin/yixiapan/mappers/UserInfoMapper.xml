<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jinjiaxin.yixiapan.mappers.UserInfoMapper">
    <insert id="add" parameterType="com.jinjiaxin.yixiapan.entity.pojo.User">
        insert into user_info values (#{user.userId},#{user.nickName},#{user.email},#{user.qqOpenId},#{user.qqAvatar},#{user.password},#{user.regisTime},#{user.lastLoginTime},#{user.status},#{user.useSpace},#{user.totalSpace})
    </insert>
    <update id="update" parameterType="com.jinjiaxin.yixiapan.entity.pojo.User">
        update user_info
        set nick_name = #{user.nickName},email = #{user.email},qq_open_id = #{user.qqOpenId},qq_avatar = #{user.qqAvatar}, password = #{user.password},regis_time = #{user.regisTime},last_login_time = #{user.lastLoginTime}, status = #{user.status},use_space = #{user.useSpace}, total_space = #{user.totalSpace} where user_id = #{user.userId}
    </update>
    <update id="updateAvatarById">
        update user_info set qq_avatar = #{user.qqAvatar} where user_id = #{userId}
    </update>
    <update id="updatePasswordById">
        update user_info set password = #{user.password} where user_id = #{userId}
    </update>
    <update id="updateUseSpace">
        update user_info
        <set>
            <if test=" useSpace != null">
                use_space = use_space + #{useSpace}
            </if>
            <if test=" totalSpace != null">
                total_space = total_space + #{totalSpace}
            </if>
        </set>
        where user_id = #{userId}
        <if test=" useSpace != null">
            and <![CDATA[(use_space + #{useSpace}) <= total_space]]>
        </if>
        <if test=" totalSpace != null">
            and <![CDATA[(total_space + #{totalSpace}) >= use_space]]>
        </if>
    </update>

    <update id="updateByUserId">
        update user_info
        <set>
            <if test="user.nickName != null"> nick_name = #{user.nickName}, </if>
            <if test="user.email != null"> email = #{user.email}, </if>
            <if test="user.qqOpenId != null"> qq_open_id = #{user.qqOpenId}, </if>
            <if test="user.qqAvatar != null"> qq_avatar = #{user.qqAvatar}, </if>
            <if test="user.password != null"> password = #{user.password}, </if>
            <if test="user.regisTime != null"> regis_time = #{user.regisTime}, </if>
            <if test="user.lastLoginTime != null"> last_login_time = #{user.lastLoginTime}, </if>
            <if test="user.status != null"> status = #{user.status}, </if>
            <if test="user.useSpace != null"> use_space = #{user.useSpace}, </if>
            <if test="user.totalSpace != null"> total_space = #{user.totalSpace}, </if>
        </set>
        where user_id = #{userId};
    </update>

    <delete id="deleteByUserId">
        delete from user_info where user_id = #{userId}
    </delete>
    <delete id="deleteByEmail">
        delete from user_info where email = #{email}
    </delete>
    <delete id="deleteByQqOpenId">
        delete
        from user_info
        where qq_open_id = #{qqOpenId};
    </delete>
    <delete id="deleteByNickName">
        delete
        from user_info
        where nick_name = #{nickName}
    </delete>
    <select id="selectByUserId" resultType="com.jinjiaxin.yixiapan.entity.pojo.User">
        select * from user_info where user_id = #{userId}
    </select>
    <select id="selectByEmail" resultType="com.jinjiaxin.yixiapan.entity.pojo.User">
        select * from user_info where email = #{email}
    </select>
    <select id="selectByQqOpenId" resultType="com.jinjiaxin.yixiapan.entity.pojo.User">
        select * from user_info where qq_open_id = #{qqOpenId}
    </select>
    <select id="selectByNickName" resultType="com.jinjiaxin.yixiapan.entity.pojo.User">
        select * from user_info where nick_name = #{nickName}
    </select>
    <select id="selectList" resultType="com.jinjiaxin.yixiapan.entity.pojo.User">
        select *
        from user_info
        where 1=1
        <if test="query.userId != null and query.userId!=''"> and user_id = #{query.userId} </if>
        <if test="query.nickName != null and query.nickName!=''"> and nick_name = #{query.nickName} </if>
        <if test="query.email != null and query.email!=''"> and email = #{query.email} </if>
        <if test="query.qqOpenId != null and query.qqOpenId!=''"> and qq_open_id = #{query.qqOpenId} </if>
        <if test="query.qqAvatar != null and query.qqAvatar!=''"> and qq_avatar = #{query.qqAvatar} </if>
        <if test="query.password != null and query.password!=''"> and password = #{query.password} </if>
        <if test="query.regisTime != null and query.regisTime!=''">
            <![CDATA[ and regis_time=str_to_date(#{query.regisTime}, '%Y-%m-%d') ]]>
        </if>
        <if test="query.lastLoginTime != null and query.lastLoginTime!=''">
            <![CDATA[ and last_login_time=str_to_date(#{query.lastLoginTime}, '%Y-%m-%d') ]]>
        </if>
        <if test="query.status != null"> and status = #{query.status} </if>
        <if test="query.useSpace != null"> and use_space = #{query.useSpace} </if>
        <if test="query.totalSpace != null"> and total_space = #{query.totalSpace} </if>
    </select>
    <select id="selectCount" resultType="java.lang.Integer">
        select count(1)
        from user_info
        where 1=1
        <if test="query.userId != null and query.userId!=''"> and user_id = #{query.userId} </if>
        <if test="query.nickName != null and query.nickName!=''"> and nick_name = #{query.nickName} </if>
        <if test="query.email != null and query.email!=''"> and email = #{query.email} </if>
        <if test="query.qqOpenId != null and query.qqOpenId!=''"> and qq_open_id = #{query.qqOpenId} </if>
        <if test="query.qqAvatar != null and query.qqAvatar!=''"> and qq_avatar = #{query.qqAvatar} </if>
        <if test="query.password != null and query.password!=''"> and password = #{query.password} </if>
        <if test="query.regisTime != null and query.regisTime!=''">
            <![CDATA[ and regis_time=str_to_date(#{query.regisTime}, '%Y-%m-%d') ]]>
        </if>
        <if test="query.lastLoginTime != null and query.lastLoginTime!=''">
            <![CDATA[ and last_login_time=str_to_date(#{query.lastLoginTime}, '%Y-%m-%d') ]]>
        </if>
        <if test="query.status != null"> and status = #{query.status} </if>
        <if test="query.useSpace != null"> and use_space = #{query.useSpace} </if>
        <if test="query.totalSpace != null"> and total_space = #{query.totalSpace} </if>
    </select>


</mapper>